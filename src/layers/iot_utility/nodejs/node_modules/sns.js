// utility functions for SNS access
var aws  = require('aws-sdk');

var _sns = new aws.SNS({"accessKeyId ":"mykey"});

// Returns a promise
function publish(topic, msg, tags={}) {
    var params = {
        Message: JSON.stringify(msg), /* required */
        MessageStructure: 'String',     /* because its not json with different message per endpoint... */
        MessageAttributes: tags,
        TopicArn: topic
    };
    const promise = new Promise(function(resolve, reject) {
        _sns.publish(params, function(err, data) {
            if (err) {
                console.log('SNS error occured:'+err, err.stack); // an error occurred
                reject(Error(err));
            } else {
                console.log('SNS data sent ok:'+JSON.stringify(data));           // successful response
                const response = {
                  statusCode: 200,
                    body: JSON.stringify('{ "result":"Sent"} '),
                };
                resolve(response);
            }
        });
    });
    return promise;
}

module.exports = { publish }
